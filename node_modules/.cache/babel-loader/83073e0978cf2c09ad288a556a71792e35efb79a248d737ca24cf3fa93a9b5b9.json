{"ast":null,"code":"import { ref } from \"vue\";\nimport { showDialog, showNotify } from \"vant\";\nimport * as bip39 from \"bip39\";\nimport { hdkey } from \"ethereumjs-wallet\";\nimport store2 from \"store2\";\nimport \"vant/es/dialog/style\";\nimport \"vant/es/notify/style\";\nexport default {\n  __name: 'Button',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const show = ref(false);\n    const password = ref(\"\");\n    const mnemonic = ref(\"\");\n    const mnemonic2 = ref(\"\");\n    const showMn = ref(false);\n    const showMnDialog = ref(false);\n    const createWallet = () => {\n      console.log(100);\n      show.value = true;\n    };\n    const confirmPassword = () => {\n      if (password.value === \"\") {\n        showNotify({\n          type: \"danger\",\n          message: \"请输入密码\"\n        });\n      } else {\n        const walletInfo = store2.get(\"walletInfo\");\n        mnemonic.value = walletInfo ? walletInfo[0][\"mnemonic\"] : bip39.generateMnemonic();\n        if (walletInfo) {\n          confirmMn();\n        } else {\n          showMn.value = true;\n        }\n      }\n    };\n    const confrimSaveMnemonic = () => {\n      showMnDialog.value = true;\n    };\n    const confirmMn = async () => {\n      //console.log(mnemonic.value)\n      // console.log(mnemonic2.value)\n\n      showMn.value = false;\n      const wInfo = store2.get(\"walletInfo\") || [];\n      if (mnemonic.value !== mnemonic2.value && wInfo.length === 0) {\n        return;\n      }\n      console.log(\"成功\");\n      const seed = await bip39.mnemonicToSeed(mnemonic.value);\n      const hdwallet = hdkey.fromMasterSeed(seed);\n      const addressIndex = wInfo.length === 0 ? 0 : wInfo.length + 1;\n      const keyPair = hdwallet.derivePath(`m/44'/60'/0'/0/${addressIndex}`);\n      const wallet = keyPair.getWallet();\n      const lowerCaseAddress = wallet.getAddressString();\n      const checkSumAddress = wallet.getChecksumAddressString();\n      const privateKey = wallet.getPrivateKey.toString(\"hex\");\n      const keyStore = await wallet.toV3(password.value);\n      const walletInfo = {\n        id: addressIndex,\n        address: lowerCaseAddress,\n        privateKey,\n        keyStore,\n        mnemonic: mnemonic.value,\n        balance: 0\n      };\n      store2(\"walletInfo\", walletInfo);\n    };\n    const __returned__ = {\n      show,\n      password,\n      mnemonic,\n      mnemonic2,\n      showMn,\n      showMnDialog,\n      createWallet,\n      confirmPassword,\n      confrimSaveMnemonic,\n      confirmMn,\n      ref,\n      get showDialog() {\n        return showDialog;\n      },\n      get showNotify() {\n        return showNotify;\n      },\n      get bip39() {\n        return bip39;\n      },\n      get hdkey() {\n        return hdkey;\n      },\n      get store2() {\n        return store2;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","showDialog","showNotify","bip39","hdkey","store2","show","password","mnemonic","mnemonic2","showMn","showMnDialog","createWallet","console","log","value","confirmPassword","type","message","walletInfo","get","generateMnemonic","confirmMn","confrimSaveMnemonic","wInfo","length","seed","mnemonicToSeed","hdwallet","fromMasterSeed","addressIndex","keyPair","derivePath","wallet","getWallet","lowerCaseAddress","getAddressString","checkSumAddress","getChecksumAddressString","privateKey","getPrivateKey","toString","keyStore","toV3","id","address","balance"],"sources":["D:/a/wallet-demo/web3-wallet-app/src/components/Button.vue"],"sourcesContent":["<script setup>\r\nimport { ref } from \"vue\";\r\nimport { showDialog, showNotify } from \"vant\";\r\nimport * as bip39 from \"bip39\";\r\nimport { hdkey } from \"ethereumjs-wallet\";\r\nimport store2 from \"store2\";\r\nimport \"vant/es/dialog/style\";\r\nimport \"vant/es/notify/style\";\r\n\r\nconst show = ref(false);\r\nconst password = ref(\"\");\r\nconst mnemonic = ref(\"\");\r\nconst mnemonic2 = ref(\"\");\r\nconst showMn = ref(false);\r\nconst showMnDialog = ref(false);\r\n\r\nconst createWallet = () => {\r\n  console.log(100);\r\n  show.value = true;\r\n};\r\n\r\nconst confirmPassword = () => {\r\n  if (password.value === \"\") {\r\n    showNotify({ type: \"danger\", message: \"请输入密码\" });\r\n  } else {\r\n    const walletInfo = store2.get(\"walletInfo\");\r\n    mnemonic.value = walletInfo\r\n      ? walletInfo[0][\"mnemonic\"]\r\n      : bip39.generateMnemonic();\r\n\r\n    if (walletInfo) {\r\n      confirmMn();\r\n    } else {\r\n      showMn.value = true;\r\n    }\r\n  }\r\n};\r\n\r\nconst confrimSaveMnemonic = () => {\r\n  showMnDialog.value = true;\r\n};\r\n\r\nconst confirmMn = async () => {\r\n  //console.log(mnemonic.value)\r\n  // console.log(mnemonic2.value)\r\n\r\n  showMn.value = false;\r\n  const wInfo = store2.get(\"walletInfo\") || [];\r\n  if (mnemonic.value !== mnemonic2.value && wInfo.length === 0) {\r\n    return\r\n  }\r\n    console.log(\"成功\");\r\n    const seed = await bip39.mnemonicToSeed(mnemonic.value);\r\n    const hdwallet = hdkey.fromMasterSeed(seed);\r\n\r\n    const addressIndex = wInfo.length === 0 ? 0 : wInfo.length + 1;\r\n\r\n    const keyPair = hdwallet.derivePath(`m/44'/60'/0'/0/${addressIndex}`);\r\n    const wallet = keyPair.getWallet();\r\n\r\n    const lowerCaseAddress = wallet.getAddressString();\r\n    const checkSumAddress = wallet.getChecksumAddressString();\r\n    const privateKey = wallet.getPrivateKey.toString(\"hex\");\r\n    const keyStore = await wallet.toV3(password.value);\r\n\r\n    const walletInfo = {\r\n      id: addressIndex,\r\n      address: lowerCaseAddress,\r\n      privateKey,\r\n      keyStore,\r\n      mnemonic: mnemonic.value,\r\n      balance: 0,\r\n    };\r\n\r\n    store2(\"walletInfo\", walletInfo);\r\n  \r\n};\r\n</script>\r\n\r\n\r\n<template>\r\n  <van-space>\r\n    <van-button type=\"primary\" @click=\"createWallet\">创建钱包</van-button>\r\n    <van-button type=\"primary\">导入钱包</van-button>\r\n    <van-dialog\r\n      v-model:show=\"show\"\r\n      title=\"标题\"\r\n      show-cancel-button\r\n      @confirm=\"confirmPassword\"\r\n    >\r\n      <van-cell-group inset>\r\n        <van-field\r\n          v-model=\"password\"\r\n          type=\"password\"\r\n          label=\"密码\"\r\n          placeholder=\"请输入密码\"\r\n        />\r\n      </van-cell-group>\r\n    </van-dialog>\r\n  </van-space>\r\n  <template v-if=\"showMn\">\r\n    <p>{{ mnemonic }}</p>\r\n    <van-button type=\"primary\" size=\"mini\" @click=\"confrimSaveMnemonic\"\r\n      >主要按钮</van-button\r\n    >\r\n    speed three jeans attend alarm runway champion soccer ring turkey cabbage\r\n    crack\r\n  </template>\r\n\r\n  <van-dialog\r\n    v-model:show=\"showMnDialog\"\r\n    title=\"请输入助记词\"\r\n    show-cancel-button\r\n    @confirm=\"confirmMn\"\r\n  >\r\n    <van-cell-group inset>\r\n      <van-field\r\n        v-model=\"mnemonic2\"\r\n        label=\"助记词\"\r\n        placeholder=\"请输入助记词\"\r\n      />\r\n    </van-cell-group>\r\n  </van-dialog>\r\n</template>\r\n\r\n<style>\r\np {\r\n  user-select: all;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}