{"ast":null,"code":"import { ref, compile, computed } from \"vue\";\nimport Web3 from \"web3\";\nimport ethwallet from \"ethereumjs-wallet\";\nexport default {\n  __name: 'AccountList',\n  props: [\"wallet-info\"],\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const web3 = new Web3(Web3.givenProvider || \"ws://localhost:8545\");\n    const show = ref(false);\n    const password = ref(\"\");\n    const keyStore = ref(\"\");\n    const address = ref(\"\");\n    const props = __props;\n\n    //keyStore.value, password.value\n    const send = async () => {\n      let walletobj;\n      try {\n        walletobj = await ethwallet.fromVw(keyStore.value, password.value);\n      } catch (error) {\n        alert(\"密码错误\");\n        return false;\n      }\n      let key = walletobj.getPrivateKey().toString('hex');\n      const privatekey = Buffer(key, \"hex\");\n      let nonce = await web3.eth.getTransactionCount(address.value);\n      let gasPrice = await web3.eth.getGasPrice();\n      let balance = web3.utils.toWei;\n    };\n    const getPassword = (keyStore, address) => {\n      show.value = true;\n      keyStore.value = keyStore;\n      address.value = address;\n    };\n    const confirmPassword = () => {\n      password.value = \"\";\n      send();\n    };\n    const walletInfoAddressFilter = computed(async () => {\n      props.walletInfo.forEach(async (item, index) => {\n        const adr = item.address;\n        const head = item.address.slice(0, 8);\n        const tail = item.address.slice(item.address.length - 8);\n        item.address = head + \"....\" + tail;\n        const bresult = await web3.eth.getBalance(adr);\n        //根据地址获取余额\n        item.balance = web3.utils.fromWei(bresult, \"ether\");\n      });\n      return props.walletInfo;\n    });\n    const __returned__ = {\n      web3,\n      show,\n      password,\n      keyStore,\n      address,\n      props,\n      send,\n      getPassword,\n      confirmPassword,\n      walletInfoAddressFilter,\n      ref,\n      compile,\n      computed,\n      get Web3() {\n        return Web3;\n      },\n      get ethwallet() {\n        return ethwallet;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","compile","computed","Web3","ethwallet","web3","givenProvider","show","password","keyStore","address","props","__props","send","walletobj","fromVw","value","error","alert","key","getPrivateKey","toString","privatekey","Buffer","nonce","eth","getTransactionCount","gasPrice","getGasPrice","balance","utils","toWei","getPassword","confirmPassword","walletInfoAddressFilter","walletInfo","forEach","item","index","adr","head","slice","tail","length","bresult","getBalance","fromWei"],"sources":["D:/a/wallet-demo/web3-wallet-app/src/components/AccountList.vue"],"sourcesContent":["<script setup>\r\nimport { ref, defineProps, compile, computed } from \"vue\";\r\nimport Web3 from \"web3\";\r\nimport ethwallet from \"ethereumjs-wallet\"\r\n\r\nconst web3 = new Web3(Web3.givenProvider || \"ws://localhost:8545\");\r\n\r\nconst show = ref(false);\r\nconst password = ref(\"\");\r\nconst keyStore = ref(\"\");\r\nconst address = ref(\"\");\r\n\r\n\r\n\r\nconst props = defineProps([\"wallet-info\"]);\r\n\r\n//keyStore.value, password.value\r\nconst send = async () => {\r\n  let walletobj;\r\n  try {\r\n    walletobj = await ethwallet.fromVw(keyStore.value, password.value);\r\n  } catch (error) {\r\n    alert(\"密码错误\");\r\n    return false;\r\n  }\r\n  let key = walletobj.getPrivateKey().toString('hex');\r\n  const privatekey = Buffer(key,\"hex\"); \r\n\r\n  let nonce = await web3.eth.getTransactionCount(address.value)\r\n\r\n  let gasPrice = await web3.eth.getGasPrice();\r\n\r\n  let balance = web3.utils.toWei\r\n\r\n\r\n\r\n\r\n\r\n};\r\n\r\nconst getPassword = (keyStore,address) => {\r\n  show.value = true;\r\n  keyStore.value = keyStore;\r\n  address.value = address;\r\n};\r\nconst confirmPassword = () => {\r\n  password.value = \"\";\r\n  send();\r\n};\r\n\r\nconst walletInfoAddressFilter = computed(async () => {\r\n  props.walletInfo.forEach(async (item, index) => {\r\n    const adr = item.address;\r\n    const head = item.address.slice(0, 8);\r\n    const tail = item.address.slice(item.address.length - 8);\r\n    item.address = head + \"....\" + tail;\r\n\r\n    const bresult = await web3.eth.getBalance(adr);\r\n    //根据地址获取余额\r\n    item.balance = web3.utils.fromWei(bresult, \"ether\");\r\n  });\r\n  return props.walletInfo;\r\n});\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <van-cell\r\n      :title=\"item.address\"\r\n      icon=\"user-o\"\r\n      v-for=\"(item, index) in walletInfoAddressFilter\"\r\n      :key=\"index\"\r\n    >\r\n      <!-- 使用 right-icon 插槽来自定义右侧图标 -->\r\n      <template #right-icon>\r\n        <van-button\r\n          type=\"primary\"\r\n          size=\"small\"\r\n          @click=\"getPassword(item.keyStore,item.address)\"\r\n          >{{ item.balance }}</van-button\r\n        >\r\n      </template>\r\n    </van-cell>\r\n  </div>\r\n  <van-dialog\r\n    v-model:show=\"show\"\r\n    title=\"标题\"\r\n    show-cancel-button\r\n    @confirm=\"confirmPassword\"\r\n  >\r\n    <van-cell-group inset>\r\n      <van-field\r\n        v-model=\"password\"\r\n        type=\"password\"\r\n        label=\"密码\"\r\n        placeholder=\"请输入密码\"\r\n      />\r\n    </van-cell-group>\r\n  </van-dialog>\r\n</template>\r\n\r\n<style>\r\n</style>"],"mappings":"AACA,SAASA,GAAgB,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,KAAK;AACzD,OAAOC,IAAI,MAAM,MAAM;AACvB,OAAOC,SAAS,MAAM,mBAAmB;;;;;;;;IAEzC,MAAMC,IAAI,GAAG,IAAIF,IAAI,CAACA,IAAI,CAACG,aAAa,IAAI,qBAAqB,CAAC;IAElE,MAAMC,IAAI,GAAGP,GAAG,CAAC,KAAK,CAAC;IACvB,MAAMQ,QAAQ,GAAGR,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMS,QAAQ,GAAGT,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMU,OAAO,GAAGV,GAAG,CAAC,EAAE,CAAC;IAIvB,MAAMW,KAAK,GAAGC,OAA4B;;IAE1C;IACA,MAAMC,IAAI,GAAG,MAAAA,CAAA,KAAY;MACvB,IAAIC,SAAS;MACb,IAAI;QACFA,SAAS,GAAG,MAAMV,SAAS,CAACW,MAAM,CAACN,QAAQ,CAACO,KAAK,EAAER,QAAQ,CAACQ,KAAK,CAAC;MACpE,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,KAAK,CAAC,MAAM,CAAC;QACb,OAAO,KAAK;MACd;MACA,IAAIC,GAAG,GAAGL,SAAS,CAACM,aAAa,CAAC,CAAC,CAACC,QAAQ,CAAC,KAAK,CAAC;MACnD,MAAMC,UAAU,GAAGC,MAAM,CAACJ,GAAG,EAAC,KAAK,CAAC;MAEpC,IAAIK,KAAK,GAAG,MAAMnB,IAAI,CAACoB,GAAG,CAACC,mBAAmB,CAAChB,OAAO,CAACM,KAAK,CAAC;MAE7D,IAAIW,QAAQ,GAAG,MAAMtB,IAAI,CAACoB,GAAG,CAACG,WAAW,CAAC,CAAC;MAE3C,IAAIC,OAAO,GAAGxB,IAAI,CAACyB,KAAK,CAACC,KAAK;IAMhC,CAAC;IAED,MAAMC,WAAW,GAAGA,CAACvB,QAAQ,EAACC,OAAO,KAAK;MACxCH,IAAI,CAACS,KAAK,GAAG,IAAI;MACjBP,QAAQ,CAACO,KAAK,GAAGP,QAAQ;MACzBC,OAAO,CAACM,KAAK,GAAGN,OAAO;IACzB,CAAC;IACD,MAAMuB,eAAe,GAAGA,CAAA,KAAM;MAC5BzB,QAAQ,CAACQ,KAAK,GAAG,EAAE;MACnBH,IAAI,CAAC,CAAC;IACR,CAAC;IAED,MAAMqB,uBAAuB,GAAGhC,QAAQ,CAAC,YAAY;MACnDS,KAAK,CAACwB,UAAU,CAACC,OAAO,CAAC,OAAOC,IAAI,EAAEC,KAAK,KAAK;QAC9C,MAAMC,GAAG,GAAGF,IAAI,CAAC3B,OAAO;QACxB,MAAM8B,IAAI,GAAGH,IAAI,CAAC3B,OAAO,CAAC+B,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;QACrC,MAAMC,IAAI,GAAGL,IAAI,CAAC3B,OAAO,CAAC+B,KAAK,CAACJ,IAAI,CAAC3B,OAAO,CAACiC,MAAM,GAAG,CAAC,CAAC;QACxDN,IAAI,CAAC3B,OAAO,GAAG8B,IAAI,GAAG,MAAM,GAAGE,IAAI;QAEnC,MAAME,OAAO,GAAG,MAAMvC,IAAI,CAACoB,GAAG,CAACoB,UAAU,CAACN,GAAG,CAAC;QAC9C;QACAF,IAAI,CAACR,OAAO,GAAGxB,IAAI,CAACyB,KAAK,CAACgB,OAAO,CAACF,OAAO,EAAE,OAAO,CAAC;MACrD,CAAC,CAAC;MACF,OAAOjC,KAAK,CAACwB,UAAU;IACzB,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}